<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <style>
    body { font-family: DejaVu Sans, sans-serif; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #333; padding: 4px; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h2>Договор № {{ item.id }}</h2>
  <p><strong>Клиент:</strong> {{ item.client_name }}</p>
  <p><strong>Телефон:</strong> {{ item.client_phone }}</p>
  <p><strong>Товар:</strong> {{ item.name }}</p>
  <p><strong>Цена:</strong> {{ "%.2f"|format(item.price) }} ₽</p>
  <p><strong>В рассрочку на:</strong> {{ item.installments }} мес.</p>
  <p><strong>Дата оформления:</strong> {{ item.created_at.strftime('%d.%m.%Y') }}</p>
  <p><strong>Оплачено:</strong> {{ "%.2f"|format(total_paid) }} ₽</p>
  <p><strong>Остаток:</strong> {{ "%.2f"|format(remaining) }} ₽</p>
  <h4>История платежей </h4>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Дата</th>
        <th>Сумма</th>
      </tr>
    </thead>
    <tbody>
      {% for payment in payments %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ payment.created_at.strftime('%d.%m.%Y') }}</td>
        <td>{{ "%.2f"|format(payment.amount) }} ₽</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</body>
</html>
